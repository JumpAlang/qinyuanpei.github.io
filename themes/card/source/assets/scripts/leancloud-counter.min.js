function VisitorCounter(e,t,i,s){this.appId=e,this.appKey=t,this.baseUrl="https://"+this.appId.substring(0,8)+".api.lncld.net",this.ipServUrl="https://api.ip.sb/jsonip",this.className="VisitorCounter",this.ipInfo={},this.headers={"X-LC-Id":this.appId,"X-LC-Key":this.appKey,"Content-Type":"application/json"},this.init=function(e){var t=e.site_uv||0,i=e.site_pv||0,s=location.href.split("//")[1];s=s.substring(0,s.indexOf("/"));var n=document.title,r={page_url:s},o=this;this.queryClass("VisitorCounter",r).then(function(e){if(0==e.results.length){var r={};r.page_pv=i,r.page_uv=t,r.page_url=s,r.page_title=n,o.createClass("VisitorCounter",r).then(function(e){console.log("init PV/UV of "+s+"success")})}}),this.injectScript(),this.pagePV(),this.pageUV(),this.sitePV(),this.siteUV()},this.sitePV=function(){var e=location.href;-1!=e.indexOf("//")&&(e=(e=e.split("//")[1]).substring(0,e.indexOf("/")));var t={page_url:e};this.queryClass("VisitorCounter",t).then(function(e){if(e.results.length>0){var t=e.results[0],i=document.getElementById("lc_counter_value_site_pv");null!=i&&(i.innerText=t.page_pv)}})},this.siteUV=function(){var e=location.href;-1!=e.indexOf("//")&&(e=(e=e.split("//")[1]).substring(0,e.indexOf("/")));var t={page_url:e};this.queryClass("VisitorCounter",t).then(function(e){if(e.results.length>0){var t=e.results[0];console.log(t);var i=document.getElementById("lc_counter_value_site_uv");null!=i&&(i.innerText=t.page_uv)}})},this.pagePV=function(){var e=location.href,t=document.title,i={page_url:e},s=this;this.queryClass("VisitorCounter",i).then(function(i){if(i.results.length>0){var n=i.results[0];(r={}).objectId=n.objectId,r.page_pv=n.page_pv,r.page_pv+=1,s.updateClass("VisitorCounter",r).then(function(e){console.log(e)}),null!=(o=document.getElementById("lc_counter_value_page_pv"))&&(o.innerText=r.page_pv)}else{var r,o;(r={}).page_title=t,r.page_url=e,r.page_pv=1,r.page_uv=1,s.createClass("VisitorCounter",r),null!=(o=document.getElementById("lc_counter_value_page_pv"))&&(o.innerText=r.page_pv)}})},this.pageUV=function(){var e=location.href,t=document.title,i=JSON.parse(localStorage.getItem("ipInfo")),s={page_url:e,visitor_ip:i.ip},n=this;n.queryClass("VisitorRecord",s).then(function(i){if(0==i.results.length){newRecord={},newRecord.page_url=e,newRecord.page_title=t;var s=JSON.parse(localStorage.getItem("ipInfo"));newRecord.visitor_ip=s.ip,newRecord.visitor_geo=s;var r=new UserAgent;newRecord.visitor_ua={raw:r.userAgent,device:r.device(),version:r.version(),from:r.from()},console.log(newRecord.visitor_ua),n.createClass("VisitorRecord",newRecord)}}).then(function(e){console.log(e)}),s={page_url:e},n.queryClass("VisitorCounter",s).then(function(e){if(e.results.length>0){var t=e.results[0];console.log(t);var i=document.getElementById("lc_counter_value_page_uv");null!=i&&(i.innerText=t.page_uv)}})},this.queryClass=function(e,t){var i=this.baseUrl+"/1.1/classes/"+e+"?where="+JSON.stringify(t);return fetch(i,{mode:"cors",method:"GET",headers:this.headers}).then(function(e){return e.json()})},this.createClass=function(e,t){var i=this.baseUrl+"/1.1/classes/"+e;return fetch(i,{mode:"cors",method:"POST",headers:this.headers,body:JSON.stringify(t)}).then(function(e){return e.json()})},this.updateClass=function(e,t){var i=this.baseUrl+"/1.1/classes/"+e+"/"+t.objectId;return fetch(i,{mode:"cors",method:"PUT",headers:this.headers,body:JSON.stringify(t)}).then(function(e){return e.json()})},this.injectScript=function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://api.ip.sb/geoip?callback=handleIP",document.getElementsByTagName("head")[0].appendChild(e),window.handleIP=function(e){this.localStorage.clear(),this.localStorage.setItem("ipInfo",this.JSON.stringify(e))}}}function UserAgent(){this.userAgent=navigator.userAgent,this.version=function(){return this.userAgent.indexOf("Trident")>-1?"Trident":this.userAgent.indexOf("Presto")>-1?"Presto":this.userAgent.indexOf("AppleWebKit")>-1?"WebKit":this.userAgent.indexOf("Safari")>-1?"Safari":this.userAgent},this.device=function(){return this.isMobile()?this.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?"iOS":this.userAgent.indexOf("Android")>-1||this.userAgent.indexOf("Linux")>-1?"Android":this.userAgent.indexOf("iPhone")>-1?"iPhone":this.userAgent.indexOf("iPad")>-1?"iPad":void 0:"PC"},this.from=function(){return this.isMobile()?"micromessenger"==this.userAgent.match(/MicroMessenger/i)?"WeChat":"weibo"==this.userAgent.match(/WeiBo/i)?"Weibo":"weibo"==this.userAgent.match(/WeiBo/i)?"Weibo":"Browser":"Browser"},this.isMobile=function(){return!!this.userAgent.match(/AppleWebKit.*Mobile.*/)}}