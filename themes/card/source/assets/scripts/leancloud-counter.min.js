function VisitorCounter(e,t,s,i){this.appId=e,this.appKey=t,this.baseUrl="https://"+this.appId.substring(0,8)+".api.lncld.net",this.ipServUrl="https://api.ip.sb/jsonip",this.className="VisitorCounter",this.ipInfo={},this.headers={"X-LC-Id":this.appId,"X-LC-Key":this.appKey,"Content-Type":"application/json"},this.init=function(e){var t=e.site_uv||0,s=e.site_pv||0,i=location.href.split("//")[1];i=i.substring(0,i.indexOf("/"));var n=document.title,r={page_url:i},o=this;this.queryClass("VisitorCounter",r).then(function(e){if(0==e.results.length){var r={};r.page_pv=s,r.page_uv=t,r.page_url=i,r.page_title=n,o.createClass("VisitorCounter",r).then(function(e){console.log("init PV/UV of "+i+"success")})}}),this.injectScript(),this.pagePV(),this.pageUV(),this.sitePV(),this.siteUV()},this.sitePV=function(){var e=location.href;-1!=e.indexOf("//")&&(e=(e=e.split("//")[1]).substring(0,e.indexOf("/")));var t={page_url:e};this.queryClass("VisitorCounter",t).then(function(e){if(e.results.length>0){var t=e.results[0],s=document.getElementById("lc_counter_value_site_pv");null!=s&&(s.innerText=t.page_pv)}})},this.siteUV=function(){var e=location.href;-1!=e.indexOf("//")&&(e=(e=e.split("//")[1]).substring(0,e.indexOf("/")));var t={page_url:e};this.queryClass("VisitorCounter",t).then(function(e){if(e.results.length>0){var t=e.results[0];console.log(t);var s=document.getElementById("lc_counter_value_site_uv");null!=s&&(s.innerText=t.page_uv)}})},this.pagePV=function(){var e=location.href,t=document.title,s={page_url:e},i=this;this.queryClass("VisitorCounter",s).then(function(s){if(s.results.length>0){var n=s.results[0];(r={}).objectId=n.objectId,r.page_pv=n.page_pv,r.page_pv+=1,i.updateClass("VisitorCounter",r).then(function(e){console.log(e)}),null!=(o=document.getElementById("lc_counter_value_page_pv"))&&(o.innerText=r.page_pv)}else{var r,o;(r={}).page_title=t,r.page_url=e,r.page_pv=1,r.page_uv=1,i.createClass("VisitorCounter",r),null!=(o=document.getElementById("lc_counter_value_page_pv"))&&(o.innerText=r.page_pv)}})},this.pageUV=function(){var e=location.href,t=document.title,s=JSON.parse(localStorage.getItem("ipInfo")),i={page_url:e,visitor_ip:s.ip},n=this;n.queryClass("VisitorRecord",i).then(function(s){if(0==s.results.length){newRecord={},newRecord.page_url=e,newRecord.page_title=t;var i=JSON.parse(localStorage.getItem("ipInfo"));newRecord.visitor_ip=i.ip,n.createClass("VisitorRecord",newRecord)}}).then(function(e){console.log(e)}),i={page_url:e},n.queryClass("VisitorCounter",i).then(function(e){if(e.results.length>0){var t=e.results[0];console.log(t);var s=document.getElementById("lc_counter_value_page_uv");null!=s&&(s.innerText=t.page_uv)}})},this.queryClass=function(e,t){var s=this.baseUrl+"/1.1/classes/"+e+"?where="+JSON.stringify(t);return fetch(s,{mode:"cors",method:"GET",headers:this.headers}).then(function(e){return e.json()})},this.createClass=function(e,t){var s=this.baseUrl+"/1.1/classes/"+e;return fetch(s,{mode:"cors",method:"POST",headers:this.headers,body:JSON.stringify(t)}).then(function(e){return e.json()})},this.updateClass=function(e,t){var s=this.baseUrl+"/1.1/classes/"+e+"/"+t.objectId;return fetch(s,{mode:"cors",method:"PUT",headers:this.headers,body:JSON.stringify(t)}).then(function(e){return e.json()})},this.injectScript=function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://api.ip.sb/jsonip?callback=handleIP",document.getElementsByTagName("head")[0].appendChild(e),window.handleIP=function(e){this.localStorage.clear(),this.localStorage.setItem("ipInfo",this.JSON.stringify(e))}}}