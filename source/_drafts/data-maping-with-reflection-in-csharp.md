---
title: '基于C#反射特性实现数据到实体的自动映射'
categories:
  - 编程语言
tags:
  - 反射
  - 数据
  - 'C#'
abbrlink: 870799730
date: 2016-01-18 12:34:19
---
&emsp;&emsp;在游戏开发中我们常常面临这样一种需求，即将策划提供的表格数据转化为相应的实体类。这个需求从某种程度上来说起着连接程序员和策划的作用，如同Shader起着连接程序员和美术的作用一样。我没有刻意贬低美术和策划的想法，可是国内大量游戏在游戏玩法上的类似、画面风格上的雷同，实在难以让我对国内的策划和美术产生敬意。因为在游戏玩法上无法做到创新，所以在这种情况下，以“数据驱动成长” + “游戏玩法复制”的策略基本成为了国内游戏研发的常规策略。这就造就了国内策划和美术的能力相当有限的情况，因为策划通常除了办公软件和脚本语言以外什么都不会，美术通常除了常用的3D建模软件以外什么都不会。我问大家为什么Shader要让程序员来写，大家苦笑道因为这是中国啊。
<!--more-->
&emsp;&emsp;好了，在文章开始说这番闲话的目的就是像告诉大家在工作中要学会换位思考，从某种程度上来说，中国的策划和美术是相当幸福的，因为和策划、美术交界的这些工作通常都是由程序员来做，我没有刻意黑策划和美术的意思，请各位知足吧！言归正传，我们今天的话题是基于C#反射特性实现数据到实体的自动映射。假设策划给了我们这样的一张Excel表格：

![实际工作中的表格一定比这个表格丑]()

现在需要我们将其转化为程序员熟悉的实体类，虽然解析Excel或者XML或者JSON这样的工作对一个程序员来说根本不能叫做工作，可是这样重复的事情一遍遍地做还能叫做程序员吗？程序员的使命就是让繁琐重复的事情变得高效简洁，因此对重复的事情我们要坚决说NO。如果你经常做这些重复的事情，请注意下面的内容，因为它会帮你从无止尽的循环中break出来。

#什么叫做反射？
&emsp;&emsp;反射的定义通常是指审查元数据并收集它的类型信息的能力。虽然我相信这个定义对我们理解反射并不会有什么实质性的意义，可是在说明一个事物的时候我们就得要有这样一个定性的描述啊。首先我们从C++编程开始说起，为什么要从C++编程开始说起呢，因为它可以帮助我们理解反射。我们知道C++编程的时候需要库文件(.lib)和头文件(.h)，为什么需要这两个东西呢？因为C++程序脱离编程环境运行的时候其实只需要一个动态链接库(.dll)就可以了，可是动态链接库对开发环节来说就是一本天书，程序员并不知道这个动态链接库里有哪些类、有哪些方法，这该怎么办呢？上帝说要有光，便有了光。因此头文件和库文件就闪亮登场了，因为有了它们两个好朋友，所以我们在进行C++编程的时候就知道哪个头文件里定义了哪些方法。而在.NET中因为有命名空间的存在，所以我们只需要引入相应的命名空间就可以调用其对应的类和方法，更为有趣的是IDE如何知道这个类库中有哪些类和方法呢？答案就是反射啦，到这里我们就能明白反射其实就是在运行时期间获取类型信息的一种方法，程序员可以通过命名空间、通过头文件和库文件来获取类型信息，那么程序靠什么呢？答案还是反射。

#反射能做什么？
&emsp;&emsp;好了，说了一大堆反射从C++说到.NET，那么反射到底能做什么呢？通常来说，我们使用反射来做下面这些事情：
* 动态创建类型示例，将类型绑定到现有对象或者从现有对象中获取类型。
* 应用程序在运行时期间从某个特定程序集载入特定类型完成特定任务。
* 在类库中类库需要了解一个类型的定义，以便提供更多的内容。

&emsp;&emsp;下面来简单介绍下.NET中反射相关的内容，这些内容主要面向不了解反射的朋友！首先在.NET中反射可以分为四个层次，即程序集->模块->类型->信息四个层次，其中信息可以分为事件、字段、属性和方法四种类型。如图所示


#利用反射解析Excel

#利用反射解析XML

#小结

