---
title: 基于Unity3D的WheelCollider开发赛车游戏
categories:
  - 游戏引擎
tags:
  - 赛车
  - WheelCollider
  - 物理引擎
abbrlink: 243334857
date: 2015-12-14 15:56:22
---
&emsp;&emsp;最近有朋友问到怎么用WheelCollider来模拟坦克履带的问题，因为对Unity引擎中物理相关内容研究相对匮乏，所以打算对引擎中的力、关节、碰撞等内容进行系统学习。Unity引擎中提供了一个称为车轮碰撞器，即WheelCollider的组件，这个碰撞器专门用来模拟汽车的车轮，所以从解决实际问题出发，我决定在今天的文章中针对WheelCollider组件来讲解下开发一个赛车游戏的基本过程。在解决了这个问题以后，我们就可以考虑解决使用WheelCollider来模拟坦克履带的问题，因为学习是一个循序渐进的过程，这些我们以后有机会再说，今天的核心内容就是使用WheelCollider组件来开发一个赛车游戏。

#赛车游戏的基本原理
&emsp;&emsp;在正式开始写这篇文章前，我想首先来介绍下赛车游戏。赛车游戏我本人更喜欢称其为“竞技游戏”，因为赛车活动在现实生活中就是以竞技比赛的形式来呈现的，所以赛车游戏从玩法上来讲就是让玩家在事先设计好的跑道上躲避障碍并以最短的时间到达终点。这样听起来赛车游戏的玩法并不复杂啊，那么赛车游戏设计得难点在哪里呢？答案是虚拟和现实间的平衡。因为从本质上来讲，赛车游戏是对现实世界的一种模拟，所以在这种情况下，赛车游戏需要满足玩家对游戏的掌控和对现实的认知。所谓对游戏的掌控就是指游戏设计要有代入感，能够让玩家觉得他就是在驾驶一辆风驰电掣般驰骋的赛车；所谓对现实的认知就是指游戏设计要有真实感，能够让玩家觉得他在驾驶赛车的过程中应对各种情况都完全符合他的预期。

&emsp;&emsp;例如在极品飞车等赛车游戏中，玩家最为津津乐道地是在各种各样的弯道上进行漂移，可是在现实生活中实现漂移需要驾驶者对速度和方向有着非常出色的掌握，可是在赛车游戏中玩家无法对赛车做到这样精细的控制，在这种情况下，能够在满足玩家享受漂移带来的快感的同时，让玩家觉得整个过程非常真实，将直接影响到一款赛车游戏给玩家的体验。所以，这就是我说的虚拟和现实间的平衡。做到这一点非常不容易，所以在这篇文章中，我下面的讲解以抛砖引玉为主，想要做到非常出色的赛车游戏需要大家继续深入研究。

&emsp;&emsp;从赛车的驱动原理上来说，赛车游戏中的车辆可以分为前轮驱动、后轮驱动和四轮驱动三种形式。赛车的动力是由发动机引擎来提供的，相应的力作用到轮胎上就会产生转数，即每分钟转动的速度，这个数值我们通常称为RPM。RPM可以由公式 ： 引擎功率 × 60/2 × pi 来计算得到。首先需要明确的一个观点是没有完全支持赛车游戏的组件或者是框架，在使用WheelCollider开发赛车游戏的时候是肯定存在不合理的地方，尤其是赛车游戏这种需要做精细物理控制的时候，我们的想法是尽量让赛车的实际效果接近现实生活中的情形而非严格地按照物理计算来进行设计。因为熟悉Unity3D的朋友一定都知道这个引擎里提供的物理计算功能是相当薄弱的，所以当你决定使用Unity3D提供的这个组件以后，相当多地和物理计算相关的细节实际上你是无法真正控制的。比如我们熟悉的漂移效果，本质上是在后驱车辆中，前轮方向旋转大角度，地面给于一定向心力，同时后轮给予更多动力这一系列模拟的整体结果。

#说说WheelCollider组件
&emsp;&emsp;好了，现在我们来说说WheelCollider这个组件，这个组件在Unity3D引擎中被称为车轮碰撞器，顾名思义它就是模拟车轮的碰撞器。它主要模拟弹簧和阻尼悬挂装置，并使用一个基于滑动轮胎摩擦力模型计算车轮接触力。这句话的意思就是说车轮碰撞器和普通的BoxCollider、SphereCollider等碰撞器不同，它允许用户来指定不同的材质来模拟道路材质、允许用户施加外力来改变车轮的状态，而内部数学模型的相关计算则由该组件来完成，用户只要通过改变外部状态就可以控制车轮的运行状态。WheelCollider组件提供下列属性，了解这些属性对理解WheelCollider碰撞模型非常有帮助。
* mass: 车轮的质量。
* radius: 车轮半径
* center: 车轮中心
* motorTorque: 电机力矩。它表示作用在轮轴上的电机力矩，让该数值为正时表示使车轮向前转动，反之则表示使车轮向后转动。当我们需要模拟刹车的时候可以考虑改变这个值，但更好的方案是设置brakeTorque，即刹车力矩，该数值必须为正。
* forwardFriction/sidewaysFriction: 分别表示向前和侧向的摩擦力，当我们需要模拟漂移效果的时候这两个属性会变得非常有用。
* suspensionDistance: 车轮的悬挂距离。这个属性我们可以理解为车轮中心到车体中心的这段距离，这段距离决定了车轮相对车体的位置。
* suspensionSpring: 车轮的悬挂弹簧。这个属性是一个关节，它和现实世界中车轮的悬挂弹簧的作用是一样的，能够保证车轮在受到地面撞击的时候有一个比较好的缓冲作用。
* steerAngle: 车轮的转向角。这个属性应该会比较容易理解，在后轮驱动的车辆中，当我们转动方向盘的时候，它可以控制前轮的转向角，因此它可以控制车辆转向。
* rpm: 车轮每分钟转速。我们在文章开头描述了它的定义，在这里它是一个只读属性，这意味着我们无法直接修改车轮的RPM。

&emsp;&emsp;其实介绍这些参数是非常枯燥的，除非我们这里有一个非常精通车辆动力学原理的人，所以这些参数我们大概了解下就好了。下面，我们来说说WheelCollider驱动的原理，因为WheelCollider将动力学模型的计算封装在内部，所以我们可以在不了解其原理的情况下直接来驱动车轮进而驱动整个车辆。通俗点的说法就是，现在我们有了这样一辆车，我们不知道采用什么方式来驱动这辆车，可是我们知道这辆车的动力来自发动机引擎啊，所以我们可以考虑给发动机一个力矩，这样发动机就可以运转起来了，这种情形类似三轮拖拉机的发动，我们只要使用摇杆转动发动机让它运转起来，发动机就可以带动车轮让这辆车驱动起来。可是这样有一个问题啊，我怎么知道使用多大的力矩来驱动发动机呢？这个时候我们需要指定一个引擎最大扭矩(EngineTorque)，最大和最小发动机转速(MaxEngineRPM/MinEngineRPM)，传动比(CurrentGear)和一个数组(GearRatio)。因为我们可以保持恒定的发动机转速的同时改变车轮的速度，所以我们需要一组齿轮(GearRatio)按照一定的转动比(CurrentGear)来进行传动，这就是WheelCollider的驱动原理。

#从头开始制作一个赛车游戏
&emsp;&emsp;接下来，我们来制作一个简单车辆
##组装一个简单车辆
##编写脚本驱动车辆
